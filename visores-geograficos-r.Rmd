---
title: "Generación de visores de datos espaciales con R"
subtitle: "Seminarios de Ecoinformática"
author: "Antonio J. Pérez-Luque"
institute: ""
date: "2022-05-05"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: "4:3"
editor_options: 
  chunk_output_type: console
---

```{r configuracion, include = FALSE}
library(knitr)
library(tidyverse)
library(fontawesome)
library(emo)
library(xaringanExtra)
library(tidyverse)
library(raster)

# set default options
opts_chunk$set(echo=FALSE,
               warning=FALSE,
               collapse = TRUE,
               dpi = 300,
               fig.align = "center")
knit_engines$set("yaml", "markdown")

xaringanExtra::use_tile_view()
xaringanExtra::use_clipboard()
xaringanExtra::use_share_again()
xaringanExtra::style_share_again(
  share_buttons = c("twitter", "linkedin", "pocket")
)

options(htmltools.preserve.raw = FALSE)
```

class: inverse, middle, center

`r fontawesome::fa("map", height = "3em")`
# ¿Cómo generar <br>visores de datos espaciales con `r fa("r-project", fill = "steelblue")`? 

---

## ... para este .red[brico-Seminario] vamos a necesitar 


> ### `r fa("map-pin", fill = "steelblue")` <br> **Información** para mostrar (espacial) 

<br>

> ### `r fa("wrench", fill = "steelblue")` <br> **Herramienta** para crear el `mapa` que queremos mostrar 

<br>

> ### `r fa("desktop", fill = "steelblue")` <br> Un **lugar** donde mostrar/alojar el mapa que hemos creado

---

class: middle, center

`r fontawesome::fa("map-pin", height = "5em", fill = "steelblue")`
# Información Espacial  

---

# Tipos de datos

# Proyección

# Datum 

---

### `r fontawesome::fa("bezier-curve", fill = "steelblue")`  Modelo vectorial 

```{r, echo=FALSE, out.width='70%', fig.align='center'}
knitr::include_graphics("img/vectors.png")
```

---

### `r fontawesome::fa("border-all", fill = "steelblue")`  Modelo raster 

```{r, echo=FALSE, out.width='70%', fig.align='center'}
knitr::include_graphics("img/raster_concept.png")
```

---

## Sitema de Referencia de Coordenadas 

- Datos espaciales = datos + CRS 

- Modelo matemático que conecta los datos con la superficie de la Tierra

- CRS le dice al software (QGIS, R, ...) en que **espacio geográfico** está la información, y qué **metodo** usar **para proyectar** la información sobre el espacio geográfico 

### "Estándares" para compartir la información CRS
  
  - [proj](http://proj4.org/):
```{r, comment="#", tidy=TRUE} 
  proj4string(CRS("+init=epsg:4326"))
```

```{r, comment="#", tidy=TRUE}
  proj4string(CRS("+init=epsg:4230"))
```
  - [EPSG](https://spatialreference.org/ref/epsg/): 
  
```{r, comment="#", tidy=TRUE}
CRS("+init=epsg:4326")
```

???
Una estructura de datos no puede considerarse geoespacial si no va acompañada de información del sistema de referencia de coordenadas (CRS), en un formato que las aplicaciones geoespaciales puedan utilizar para mostrar y manipular los datos correctamente. La información CRS conecta los datos con la superficie de la Tierra mediante un modelo matemático.

https://mappinggis.com/2016/04/los-codigos-epsg-srid-vinculacion-postgis/


---
class:center, middle 

### The peel analogy 

> #### CRS = `Datum` + `Proyección` + `parámetros adicionales` 

.pull-left[
![](img/orange_lemon.jpeg)
] 

.pull-right[
![](img/orange_flatten.jpeg)
] 


???
- Imagina que la tierra es una naranja. La forma en la que la pelamos y la aplanamos es similar a lo que hace una proyección. 
- El datum se refiere a la elección de la fruta: ¿es la tierra una naranja, un limón, una lima? 
- La proyección es la forma de pelar la cáscara y luego aplanar la piel
- Otros parámetros adicionales pueden referirse a la ubicación del tallo de la naranja 

---

## Recursos sobre Información espacial + `r fa("r-project", height= "2em", fill = "steelblue")`

- [Análisis espacial con R: Usa R como un Sistema de Información Geográfica](https://eujournal.org/files/journals/1/books/JeanFrancoisMas.pdf). J.F. Mas. 

- [GIS with R](https://pakillo.github.io/GISwithR/GISwithR.html). F. Rodríguez-Sánchez 

- [Geocomputation with R](https://geocompr.robinlovelace.net/). R. Lovelace et *al.* (2022)

- Varios tutoriales de [NEON](https://jsta.github.io/r-spatial-data-management-intro/spatial-data-gis/)

- [r-spatial](https://r-spatial.org/about/). Pebesma et *al.*
 
- [Spatial Data Science with R](https://rspatial.org/)

- `r fa("r-project", fill = "steelblue")` [Cran Task View](https://cran.r-project.org/web/views/Spatial.html)

- [R Projections Workshop](https://github.com/MicheleTobias/R-Projections-Workshop)

- [World Map Projections](https://michaelminn.net/tutorials/gis-projections-world/index.html)

- [Cheatseet de CRS in R](https://www.nceas.ucsb.edu/sites/default/files/2020-04/OverviewCoordinateReferenceSystems.pdf). NCEAS 

---

### Información a mostrar 

```{r, echo=FALSE}
library(tidyverse)
library(here)
library(raster)
```

```{r, echo=TRUE, tidy=TRUE, fig.height=5, fig.align='center'}
library(sf)
sn <- st_read(here::here("data/sn_enp.shp"), quiet = TRUE) #<<
plot(st_geometry(sn))
```


---

¿Qué proyección tiene nuestra capa? 
```{r, echo=TRUE, results='asis'}
projection(sn)
```

```{r, echo=TRUE, results='asis'}
sn <- st_transform(sn, 4326)
projection(sn)
```


---

class: middle, center

`r fontawesome::fa("wrench", height = "5em", fill = "steelblue")`
# **Herramienta** para crear el `mapa` 

---
### Uso de leaflet 

```{r, echo=FALSE, out.width='70%', fig.align='center'}
knitr::include_graphics("img/Leaflet_logo.png")
```

- Que és Leaflet 
- Uso básico 
- Leaflet + R 
- plugins 

---

```{r, echo = TRUE, out.width = '80%', out.height='70%', fig.align='center'}
library(leaflet)

leaflet() %>% 
  addTiles() %>% 
  addMarkers(lng=-3.311572, lat=37.053434, popup="Mulhacen")
  
```

---
### Sobre que base 
Los servicios WMS

- Qué son? 
- Tipos? 
- Fuentes de WMS?

---

Combinación con flexdasboard 

html directo 


--- 
